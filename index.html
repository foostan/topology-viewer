<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Force based label placement</title>
  <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js?2.6.0"></script>
  <style>
    #topology {
      background-color: #fff;
    }

    line.link {
      stroke: #ccc;
    }

    line.rule {
      stroke: #eee;
    }

    g.node circle {
      fill: #eee;
      stroke: #bbb;
    }

    text.label {
      color: #555;
    }
  </style>
</head>
<body>
<div id="topology">
  <script type="text/javascript" charset="utf-8">
    var width = document.documentElement.clientWidth;
    var height = document.documentElement.clientHeight;
    var xscale = d3.scale.linear().domain([0, 100]).range([width / 4, width / 4 * 3]);
    var yscale = d3.scale.linear().domain([0, 100]).range([height / 4, height / 4 * 3]);

    const LAYER_5 = 0, LAYER_4 = 25, LAYER_3 = 50, LAYER_2 = 75, LAYER_1 = 0;

    var vis = d3.select("#topology")
      .append("svg:svg")
      .attr("width", width)
      .attr("height", height);

    for (y = 0; y <= 100; y += 25) {
      vis.append("line")
        .attr("x1", xscale(0))
        .attr("y1", yscale(y))
        .attr("x2", xscale(100))
        .attr("y2", yscale(y))
        .attr("class", "rule");
    }

    var nodes = [
      {
        x: xscale(40),
        y: yscale(LAYER_5),
        label: "node 1",
        fixed: true
      }, {
        x: xscale(60),
        y: yscale(LAYER_5),
        label: "node 2",
        fixed: true
      }, {
        x: xscale(40),
        y: yscale(LAYER_4),
        label: "node 3",
        fixed: true
      }, {
        x: xscale(60),
        y: yscale(LAYER_4),
        label: "node 4",
        fixed: true
      }, {
        x: xscale(20),
        y: yscale(LAYER_3),
        label: "node 5",
        fixed: true
      }, {
        x: xscale(50),
        y: yscale(LAYER_3),
        label: "node 6",
        fixed: true
      }, {
        x: xscale(80),
        y: yscale(LAYER_3),
        label: "node 7",
        fixed: true
      }];

    var links = [
      {source: 0, target: 1},
      {source: 0, target: 2},
      {source: 0, target: 3},
      {source: 1, target: 2},
      {source: 1, target: 3},
      {source: 2, target: 3},
      {source: 2, target: 4},
      {source: 2, target: 5},
      {source: 2, target: 6},
      {source: 3, target: 4},
      {source: 3, target: 5},
      {source: 3, target: 6}];

    var force = d3.layout.force()
      .size([width, height])
      .nodes(nodes)
      .links(links)
      .start();

    var link = vis.selectAll("line.link")
      .data(links).enter()
      .append("svg:line")
      .attr("class", "link");

    var node = vis.selectAll("g.node")
      .data(nodes).enter()
      .append("svg:g")
      .attr("class", "node");

    node.append("svg:circle")
      .style("stroke-width", 5)
      .attr("r", 20);

    node.append("svg:text")
      .attr("class", "label")
      .text(function (d) {
        return d.label;
      });


    var updateLink = function () {
      this.attr("x1", function (d) {
        return d.source.x;
      }).attr("y1", function (d) {
        return d.source.y;
      }).attr("x2", function (d) {
        return d.target.x;
      }).attr("y2", function (d) {
        return d.target.y;
      });
    };

    var updateNode = function () {
      this.attr("transform", function (d) {
        return "translate(" + d.x + "," + d.y + ")";
      });
    };

    force.on("tick", function () {
      node.call(updateNode);
      link.call(updateLink);
    });

  </script>
</div>
</body>
</html>
